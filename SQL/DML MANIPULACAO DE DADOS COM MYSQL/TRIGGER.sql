CREATE TABLE FATURAMENTO(
DATA_VENDA DATE NULL,
TOTAL_VENDA FLOAT
);

DELETE FROM NOTAS;
DELETE FROM tabela_itens_notas;

SELECT * FROM NOTAS;
SELECT * FROM tabela_itens_notas;
SELECT * FROM vendedores;
SELECT * FROM PRODUTOS;
SELECT * FROM CLIENTES;

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO) VALUES ('0100', '2022-06-08', '1471156710', '235', 0.10);
INSERT INTO TABELA_ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO) VALUES ('0100','1000889',100,10);
INSERT INTO TABELA_ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO) VALUES ('0100','1002334',100,10);

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO) VALUES ('0101', '2022-06-08', '1471156710', '235', 0.10);
INSERT INTO TABELA_ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO) VALUES ('0101','1000889',100,10);
INSERT INTO TABELA_ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO) VALUES ('0101','1002334',100,10);

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO) VALUES ('0102', '2022-06-08', '1471156710', '235', 0.10);
INSERT INTO TABELA_ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO) VALUES ('0102','1000889',100,10);
INSERT INTO TABELA_ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO) VALUES ('0102','1002334',100,10);

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO) VALUES ('0103', '2022-06-08', '1471156710', '235', 0.10);
INSERT INTO TABELA_ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO) VALUES ('0103','1000889',100,10);
INSERT INTO TABELA_ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO) VALUES ('0103','1002334',100,10);

INSERT INTO FATURAMENTO
SELECT A.DATA_VENDA, SUM(B.QUANTIDADE * B.PRECO) AS TOTAL_VENDA FROM
NOTAS A INNER JOIN tabela_itens_notas B
ON A.NUMERO = B.NUMERO
GROUP BY DATA_VENDA;

DELIMITER //
CREATE TRIGGER TG_CALCULA_FATURAMENTO_INSERT AFTER INSERT ON tabela_itens_notas
FOR EACH ROW BEGIN 
	DELETE FROM FATURAMENTO;
	INSERT INTO FATURAMENTO
	SELECT A.DATA_VENDA, SUM(B.QUANTIDADE * B.PRECO) AS TOTAL_VENDA FROM
	NOTAS A INNER JOIN tabela_itens_notas B
	ON A.NUMERO = B.NUMERO
	GROUP BY DATA_VENDA;
END//

SELECT * FROM FATURAMENTO;
DELETE FROM FATURAMENTO;